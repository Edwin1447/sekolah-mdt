<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Siswa - MDT Nurul Inayah</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="datasiswa.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>MDT Nurul Inayah</h3>
            <div class="subtitle">Sistem Informasi Sekolah</div>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="dashboard_admin.html" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link active">
                    <i class="fas fa-user-graduate"></i>
                    Data Siswa
                </a>
            </li>
            <li class="nav-item">
                <a href="data-siswa-baru.html" class="nav-link">
                    <i class="fas fa-user-plus"></i>
                    Data Siswa Baru
                </a>
            </li>
            <li class="nav-item">
                <a href="data-guru.html" class="nav-link">
                    <i class="fas fa-chalkboard-teacher"></i>
                    Data Guru
                </a>
            </li>
            <li class="nav-item">
                <a href="laporan.html" class="nav-link">
                    <i class="fas fa-chart-bar"></i>
                    Laporan
                </a>
            </li>
            <li class="nav-item">
                <a href="logout.html" class="nav-link">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <h1>Data Siswa</h1>
            <div class="breadcrumb">
                <i class="fas fa-home"></i> Beranda / Data Siswa
            </div>
        </div>

        <!-- Class Selector -->
        <div class="section-card">
            <h3 class="section-title">
                <i class="fas fa-users"></i>
                Pilih Kelas
            </h3>
            <div class="class-selector">
                <button class="class-btn active" onclick="selectClass(1)">Kelas 1</button>
                <button class="class-btn" onclick="selectClass(2)">Kelas 2</button>
                <button class="class-btn" onclick="selectClass(3)">Kelas 3</button>
                <button class="class-btn" onclick="selectClass(4)">Kelas 4</button>
            </div>
        </div>

        <!-- Form Input Siswa -->
        <div class="section-card">
            <h3 class="section-title">
                <i class="fas fa-user-plus"></i>
                Input Data Siswa - <span id="currentClassName">Kelas 1</span>
            </h3>
            <div class="form-section">
                <form id="studentForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nisn">NISN</label>
                            <input type="text" class="form-control" id="nisn" required>
                        </div>
                        <div class="form-group">
                            <label for="namaLengkap">Nama Lengkap</label>
                            <input type="text" class="form-control" id="namaLengkap" required>
                        </div>
                        <div class="form-group">
                            <label for="jenisKelamin">Jenis Kelamin</label>
                            <select class="form-control" id="jenisKelamin" required>
                                <option value="">Pilih Jenis Kelamin</option>
                                <option value="L">Laki-laki</option>
                                <option value="P">Perempuan</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tempatLahir">Tempat Lahir</label>
                            <input type="text" class="form-control" id="tempatLahir" required>
                        </div>
                        <div class="form-group">
                            <label for="tanggalLahir">Tanggal Lahir</label>
                            <input type="date" class="form-control" id="tanggalLahir" required>
                        </div>
                        <div class="form-group">
                            <label for="alamat">Alamat</label>
                            <input type="text" class="form-control" id="alamat" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="namaOrangTua">Nama Orang Tua</label>
                            <input type="text" class="form-control" id="namaOrangTua" required>
                        </div>
                        <div class="form-group">
                            <label for="noTelepon">No. Telepon</label>
                            <input type="tel" class="form-control" id="noTelepon" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Simpan Data Siswa
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-undo"></i> Reset Form
                    </button>
                </form>
            </div>
        </div>

        <!-- Data Table Siswa -->
        <div class="section-card">
            <h3 class="section-title">
                <i class="fas fa-table"></i>
                Data Siswa - <span id="tableClassName">Kelas 1</span>
            </h3>
            <div class="loading" id="loadingTable">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p>Memuat data siswa...</p>
            </div>
            <div class="table-responsive">
                <table class="table table-hover" id="studentTable">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>NISN</th>
                            <th>Nama Lengkap</th>
                            <th>L/P</th>
                            <th>Tempat, Tanggal Lahir</th>
                            <th>Alamat</th>
                            <th>Orang Tua</th>
                            <th>No. Telepon</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="studentTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Input Nilai Section -->
        <div class="section-card">
            <h3 class="section-title">
                <i class="fas fa-chart-line"></i>
                Input Nilai Siswa - <span id="nilaiClassName">Kelas 1</span>
            </h3>
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="selectSiswa">Pilih Siswa</label>
                        <select class="form-control" id="selectSiswa" onchange="loadStudentGrades()">
                            <option value="">Pilih Siswa</option>
                        </select>
                    </div>
                </div>
                <div id="gradeInputs" style="display: none;">
                    <h5 style="color: var(--primary-green); margin-bottom: 20px;">
                        <i class="fas fa-book"></i> Input Nilai Mata Pelajaran
                    </h5>
                    <div id="subjectInputs">
                        <!-- Subject inputs will be generated by JavaScript -->
                    </div>
                    <button type="button" class="btn btn-primary" onclick="saveGrades()">
                        <i class="fas fa-save"></i> Simpan Nilai
                    </button>
                    <div class="average-display" id="averageDisplay" style="display: none;">
                        <div class="average-score" id="studentAverage">0</div>
                        <div>Rata-rata Nilai Siswa</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Edit Siswa -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit"></i> Edit Data Siswa
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editNisn">NISN</label>
                                <input type="text" class="form-control" id="editNisn" required>
                            </div>
                            <div class="form-group">
                                <label for="editNamaLengkap">Nama Lengkap</label>
                                <input type="text" class="form-control" id="editNamaLengkap" required>
                            </div>
                            <div class="form-group">
                                <label for="editJenisKelamin">Jenis Kelamin</label>
                                <select class="form-control" id="editJenisKelamin" required>
                                    <option value="L">Laki-laki</option>
                                    <option value="P">Perempuan</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editTempatLahir">Tempat Lahir</label>
                                <input type="text" class="form-control" id="editTempatLahir" required>
                            </div>
                            <div class="form-group">
                                <label for="editTanggalLahir">Tanggal Lahir</label>
                                <input type="date" class="form-control" id="editTanggalLahir" required>
                            </div>
                            <div class="form-group">
                                <label for="editAlamat">Alamat</label>
                                <input type="text" class="form-control" id="editAlamat" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="editNamaOrangTua">Nama Orang Tua</label>
                                <input type="text" class="form-control" id="editNamaOrangTua" required>
                            </div>
                            <div class="form-group">
                                <label for="editNoTelepon">No. Telepon</label>
                                <input type="tel" class="form-control" id="editNoTelepon" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="updateStudent()">
                        <i class="fas fa-save"></i> Update Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentClass = 1;
        let studentsData = {
            1: [], 2: [], 3: [], 4: []
        };
        let gradesData = {
            1: {}, 2: {}, 3: {}, 4: {}
        };
        let subjects = [
            'Bahasa Indonesia', 'Matematika', 'IPA', 'IPS', 
            'Pendidikan Agama Islam', 'Bahasa Arab', 'Al-Quran Hadits', 
            'Fiqh', 'Akidah Akhlak', 'Sejarah Kebudayaan Islam'
        ];

        // API Base URL - Ganti dengan URL server PHP Anda
        const API_BASE_URL = 'api/'; // Contoh: 'http://localhost/sekolah-api/'

        // Fungsi untuk select class
        function selectClass(classNumber) {
            currentClass = classNumber;
            
            // Update active button
            document.querySelectorAll('.class-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update class names
            document.getElementById('currentClassName').textContent = `Kelas ${classNumber}`;
            document.getElementById('tableClassName').textContent = `Kelas ${classNumber}`;
            document.getElementById('nilaiClassName').textContent = `Kelas ${classNumber}`;
            
            // Load data for selected class
            loadStudentData();
            loadStudentOptions();
        }

        // Fungsi untuk load data siswa dari database
        async function loadStudentData() {
            document.getElementById('loadingTable').style.display = 'block';
            
            try {
                const response = await fetch(`${API_BASE_URL}get_students.php?class=${currentClass}`);
                const data = await response.json();
                
                if (data.success) {
                    studentsData[currentClass] = data.students;
                    renderStudentTable();
                    updateDashboardStats();
                } else {
                    console.error('Error loading students:', data.message);
                }
            } catch (error) {
                console.error('Network error:', error);
                // Fallback to dummy data for demo
                loadDummyData();
            }
            
            document.getElementById('loadingTable').style.display = 'none';
        }

        // Dummy data untuk demo
        function loadDummyData() {
            if (studentsData[currentClass].length === 0) {
                studentsData[currentClass] = [
                    {
                        id: 1,
                        nisn: '1234567890',
                        nama_lengkap: 'Ahmad Fauzan',
                        jenis_kelamin: 'L',
                        tempat_lahir: 'Jakarta',
                        tanggal_lahir: '2015-05-15',
                        alamat: 'Jl. Masjid No. 123',
                        nama_orang_tua: 'Bapak Ahmad',
                        no_telepon: '08123456789'
                    }
                ];
            }
            renderStudentTable();
        }

        // Render tabel siswa
        function renderStudentTable() {
            const tbody = document.getElementById('studentTableBody');
            const students = studentsData[currentClass] || [];
            
            tbody.innerHTML = '';
            
            students.forEach((student, index) => {
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${student.nisn}</td>
                        <td>${student.nama_lengkap}</td>
                        <td>
                            <span class="badge ${student.jenis_kelamin === 'L' ? 'badge-primary' : 'badge-success'}">
                                ${student.jenis_kelamin === 'L' ? 'Laki-laki' : 'Perempuan'}
                            </span>
                        </td>
                        <td>${student.tempat_lahir}, ${formatDate(student.tanggal_lahir)}</td>
                        <td>${student.alamat}</td>
                        <td>${student.nama_orang_tua}</td>
                        <td>${student.no_telepon}</td>
                        <td>
                            <button class="btn btn-warning btn-sm" onclick="editStudent(${student.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent(${student.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // Format tanggal
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        }

        // Submit form siswa
        document.getElementById('studentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                nisn: document.getElementById('nisn').value,
                nama_lengkap: document.getElementById('namaLengkap').value,
                jenis_kelamin: document.getElementById('jenisKelamin').value,
                tempat_lahir: document.getElementById('tempatLahir').value,
                tanggal_lahir: document.getElementById('tanggalLahir').value,
                alamat: document.getElementById('alamat').value,
                nama_orang_tua: document.getElementById('namaOrangTua').value,
                no_telepon: document.getElementById('noTelepon').value,
                kelas: currentClass
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}add_student.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Data siswa berhasil disimpan!');
                    resetForm();
                    loadStudentData();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                // Demo mode - add to local storage
                formData.id = Date.now();
                studentsData[currentClass].push(formData);
                renderStudentTable();
                updateDashboardStats();
                resetForm();
                alert('Data siswa berhasil disimpan! (Demo Mode)');
            }
        });

        // Reset form
        function resetForm() {
            document.getElementById('studentForm').reset();
        }

        // Edit student
        function editStudent(id) {
            const student = studentsData[currentClass].find(s => s.id == id);
            if (!student) return;
            
            document.getElementById('editId').value = student.id;
            document.getElementById('editNisn').value = student.nisn;
            document.getElementById('editNamaLengkap').value = student.nama_lengkap;
            document.getElementById('editJenisKelamin').value = student.jenis_kelamin;
            document.getElementById('editTempatLahir').value = student.tempat_lahir;
            document.getElementById('editTanggalLahir').value = student.tanggal_lahir;
            document.getElementById('editAlamat').value = student.alamat;
            document.getElementById('editNamaOrangTua').value = student.nama_orang_tua;
            document.getElementById('editNoTelepon').value = student.no_telepon;
            
            new bootstrap.Modal(document.getElementById('editModal')).show();
        }

        // Update student
        async function updateStudent() {
            const id = document.getElementById('editId').value;
            const formData = {
                id: id,
                nisn: document.getElementById('editNisn').value,
                nama_lengkap: document.getElementById('editNamaLengkap').value,
                jenis_kelamin: document.getElementById('editJenisKelamin').value,
                tempat_lahir: document.getElementById('editTempatLahir').value,
                tanggal_lahir: document.getElementById('editTanggalLahir').value,
                alamat: document.getElementById('editAlamat').value,
                nama_orang_tua: document.getElementById('editNamaOrangTua').value,
                no_telepon: document.getElementById('editNoTelepon').value,
                kelas: currentClass
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}update_student.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Data siswa berhasil diupdate!');
                    bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                    loadStudentData();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                // Demo mode - update local data
                const index = studentsData[currentClass].findIndex(s => s.id == id);
                if (index !== -1) {
                    studentsData[currentClass][index] = formData;
                    renderStudentTable();
                    updateDashboardStats();
                    bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
                    alert('Data siswa berhasil diupdate! (Demo Mode)');
                }
            }
        }

        // Delete student
        async function deleteStudent(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data siswa ini?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}delete_student.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ id: id, kelas: currentClass })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Data siswa berhasil dihapus!');
                    loadStudentData();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                // Demo mode - delete from local data
                studentsData[currentClass] = studentsData[currentClass].filter(s => s.id != id);
                renderStudentTable();
                updateDashboardStats();
                loadStudentOptions();
                alert('Data siswa berhasil dihapus! (Demo Mode)');
            }
        }

        // Load student options untuk dropdown nilai
        function loadStudentOptions() {
            const select = document.getElementById('selectSiswa');
            const students = studentsData[currentClass] || [];
            
            select.innerHTML = '<option value="">Pilih Siswa</option>';
            
            students.forEach(student => {
                select.innerHTML += `<option value="${student.id}">${student.nama_lengkap}</option>`;
            });
        }

        // Load student grades
        async function loadStudentGrades() {
            const studentId = document.getElementById('selectSiswa').value;
            if (!studentId) {
                document.getElementById('gradeInputs').style.display = 'none';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}get_grades.php?student_id=${studentId}&class=${currentClass}`);
                const data = await response.json();
                
                if (data.success) {
                    renderGradeInputs(studentId, data.grades);
                } else {
                    console.error('Error loading grades:', data.message);
                    renderGradeInputs(studentId, {});
                }
            } catch (error) {
                console.error('Network error:', error);
                // Demo mode
                const grades = gradesData[currentClass][studentId] || {};
                renderGradeInputs(studentId, grades);
            }
            
            document.getElementById('gradeInputs').style.display = 'block';
        }

        // Render grade inputs
        function renderGradeInputs(studentId, grades) {
            const container = document.getElementById('subjectInputs');
            container.innerHTML = '';
            
            subjects.forEach(subject => {
                const value = grades[subject] || '';
                const row = `
                    <div class="subject-row">
                        <div class="subject-label">${subject}</div>
                        <input type="number" 
                               class="form-control nilai-input" 
                               id="nilai_${subject.replace(/\s+/g, '_')}" 
                               min="0" 
                               max="100" 
                               value="${value}"
                               onchange="calculateAverage()">
                        <span class="badge ${getGradeBadge(value)}">${getGradeLabel(value)}</span>
                    </div>
                `;
                container.innerHTML += row;
            });
            
            calculateAverage();
        }

        // Get grade badge class
        function getGradeBadge(nilai) {
            if (nilai >= 80) return 'badge-success';
            if (nilai >= 70) return 'badge-warning';
            if (nilai >= 60) return 'badge-primary';
            return 'badge-danger';
        }

        // Get grade label
        function getGradeLabel(nilai) {
            if (nilai >= 90) return 'A';
            if (nilai >= 80) return 'B';
            if (nilai >= 70) return 'C';
            if (nilai >= 60) return 'D';
            return nilai ? 'E' : '-';
        }

        // Calculate average
        function calculateAverage() {
            const inputs = document.querySelectorAll('.nilai-input');
            let total = 0;
            let count = 0;
            
            inputs.forEach(input => {
                if (input.value && input.value > 0) {
                    total += parseFloat(input.value);
                    count++;
                }
            });
            
            const average = count > 0 ? (total / count).toFixed(1) : 0;
            document.getElementById('studentAverage').textContent = average;
            document.getElementById('averageDisplay').style.display = count > 0 ? 'block' : 'none';
        }

        // Save grades
        async function saveGrades() {
            const studentId = document.getElementById('selectSiswa').value;
            if (!studentId) {
                alert('Pilih siswa terlebih dahulu!');
                return;
            }
            
            const grades = {};
            subjects.forEach(subject => {
                const input = document.getElementById(`nilai_${subject.replace(/\s+/g, '_')}`);
                if (input.value) {
                    grades[subject] = parseFloat(input.value);
                }
            });
            
            const gradeData = {
                student_id: studentId,
                kelas: currentClass,
                grades: grades
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}save_grades.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(gradeData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Nilai berhasil disimpan!');
                    updateDashboardStats();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                // Demo mode - save to local storage
                if (!gradesData[currentClass][studentId]) {
                    gradesData[currentClass][studentId] = {};
                }
                gradesData[currentClass][studentId] = grades;
                updateDashboardStats();
                alert('Nilai berhasil disimpan! (Demo Mode)');
            }
        }

        // Update dashboard stats
        function updateDashboardStats() {
            // Hitung total siswa per kelas
            const classStats = {};
            let totalStudents = 0;
            
            for (let i = 1; i <= 4; i++) {
                classStats[`kelas${i}`] = studentsData[i].length;
                totalStudents += studentsData[i].length;
            }
            
            // Hitung rata-rata nilai per kelas
            const averageStats = {};
            for (let i = 1; i <= 4; i++) {
                const classGrades = gradesData[i];
                let totalAverage = 0;
                let studentCount = 0;
                
                Object.values(classGrades).forEach(studentGrades => {
                    const values = Object.values(studentGrades);
                    if (values.length > 0) {
                        const avg = values.reduce((a, b) => a + b, 0) / values.length;
                        totalAverage += avg;
                        studentCount++;
                    }
                });
                
                averageStats[`kelas${i}`] = studentCount > 0 ? 
                    (totalAverage / studentCount).toFixed(1) : 0;
            }
            
            // Update ke localStorage untuk dashboard
            const dashboardData = {
                siswa: classStats,
                nilaiRataRata: averageStats,
                totalSiswa: totalStudents,
                lastUpdate: new Date().toISOString()
            };
            
            localStorage.setItem('schoolDashboardData', JSON.stringify(dashboardData));
            
            // Trigger update dashboard jika ada
            if (typeof window.updateDashboardFromData === 'function') {
                window.updateDashboardFromData(dashboardData);
            }
        }

        // Send data to database
        async function syncToDatabase() {
            try {
                const syncData = {
                    students: studentsData,
                    grades: gradesData
                };
                
                const response = await fetch(`${API_BASE_URL}sync_data.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(syncData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    console.log('Data berhasil disinkronisasi ke database');
                } else {
                    console.error('Error syncing data:', data.message);
                }
            } catch (error) {
                console.error('Network error during sync:', error);
            }
        }

        // Load initial data
        document.addEventListener('DOMContentLoaded', function() {
            loadStudentData();
            loadStudentOptions();
            
            // Load saved data from localStorage if available
            const savedData = localStorage.getItem('schoolStudentData');
            if (savedData) {
                const data = JSON.parse(savedData);
                studentsData = data.students || studentsData;
                gradesData = data.grades || gradesData;
                renderStudentTable();
                loadStudentOptions();
            }
            
            // Auto-save to localStorage every 30 seconds
            setInterval(() => {
                const dataToSave = {
                    students: studentsData,
                    grades: gradesData
                };
                localStorage.setItem('schoolStudentData', JSON.stringify(dataToSave));
            }, 30000);
        });

        // Auto sync to database every 5 minutes
        setInterval(syncToDatabase, 300000);
    </script>
</body>
</html>